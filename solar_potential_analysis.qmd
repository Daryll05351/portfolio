---
title: "Solar Potential Analysis by Region"
author: "Daryll"
format:
  html:
    toc: true
    toc-depth: 2
    code-fold: true
    code-tools: true
    df-print: paged
---


```{r setup}
library(tidyverse)
library(readr)
library(readxl)
library(ggplot2)
library(scales)
```

## 1. Load and Preview Data

```{r load-data}
# Load CSV data
tract_df <- read_csv("solar_potential_by_censustract.csv")
postal_df <- read_csv("solar_potential_by_postal_code.csv")

# Load Excel schema
schema <- read_excel("solar_potential_schema.xlsx")

# Preview
glimpse(tract_df)
glimpse(postal_df)
```

## 2. Explore Schema Description

```{r schema-summary}
schema %>%
    select(`Field name`, Description) %>%
    head(10)
```

## 3. Summary Statistics

```{r summary-statistics}
tract_df %>%
    summarise(across(where(is.numeric), list(mean = mean, median = median), na.rm = TRUE))
```

## 4. Sunlight Distribution Analysis

```{r sunlight-distribution}
ggplot(tract_df, aes(x = yearly_sunlight_kwh_kw_threshold_avg)) +
    geom_histogram(bins = 50, fill = "goldenrod", color = "white") +
    labs(title = "Yearly Sunlight per kW Threshold (Census Tract)", x = "kWh/kW", y = "Count")
```

## 5. Top States by Qualified Count

```{r top-qualified-states}
tract_df %>%
    group_by(state_name) %>%
    summarise(Total_Qualified = sum(count_qualified, na.rm = TRUE)) %>%
    arrange(desc(Total_Qualified)) %>%
    slice_head(n = 10) %>%
    ggplot(aes(x = reorder(state_name, Total_Qualified), y = Total_Qualified)) +
    geom_col(fill = "steelblue") +
    coord_flip() +
    labs(title = "Top 10 States by Qualified Solar Potential Count", x = "State", y = "Qualified Count")
```

## 6. Compare Solar Potential by Region Type

```{r region-comparison}
tract_df <- tract_df %>% mutate(Source = "Census Tract")
postal_df <- postal_df %>% mutate(Source = "Postal Code")

combined_df <- bind_rows(tract_df, postal_df)

combined_df %>%
    ggplot(aes(x = Source, y = yearly_sunlight_kwh_kw_threshold_avg, fill = Source)) +
    geom_boxplot() +
    labs(title = "Comparison of Yearly Solar Potential", y = "kWh/kW", x = "Region Type")
```

## 7. Relationship Between Sunlight and Qualified Count

```{r correlation-scatterplot}
ggplot(tract_df, aes(x = yearly_sunlight_kwh_kw_threshold_avg, y = count_qualified)) +
    geom_point(alpha = 0.4, color = "darkgreen") +
    scale_y_log10(labels = comma) +
    labs(
        title = "Correlation Between Sunlight and Qualified Count",
        x = "Yearly Sunlight (kWh/kW)",
        y = "Qualified Count (log scale)"
    )
```

## 8. Conclusion

This analysis explored the solar potential data in R. It included:

- California state is the highest qualified solar potential state in the US.
- 


